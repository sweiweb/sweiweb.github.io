<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>POSCAR的脚本处理 | 何事？</title><meta name="description" content="POSCAR的脚本处理"><meta name="keywords" content="脚本,shell,matlab"><meta name="author" content="孙 伟"><meta name="copyright" content="孙 伟"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/theme/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="POSCAR的脚本处理"><meta name="twitter:description" content="POSCAR的脚本处理"><meta name="twitter:image" content="https://sweiweb.gitee.io/img/posts_cover/POSCAR%E7%9A%84%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86.jpg"><meta property="og:type" content="article"><meta property="og:title" content="POSCAR的脚本处理"><meta property="og:url" content="https://sweiweb.gitee.io/poscar/"><meta property="og:site_name" content="何事？"><meta property="og:description" content="POSCAR的脚本处理"><meta property="og:image" content="https://sweiweb.gitee.io/img/posts_cover/POSCAR%E7%9A%84%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="canonical" href="https://sweiweb.gitee.io/poscar/"><link rel="prev" title="替换EXE图标" href="https://sweiweb.gitee.io/replace_icon/"><link rel="next" title="SSH远程登录脚本" href="https://sweiweb.gitee.io/ssh_script/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://sweiweb.gitee.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: false,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="何事？" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/theme/avatar.png" onerror="onerror=null;src='/img/theme/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">15</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 图库</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#固定原子坐标"><span class="toc-number">1.</span> <span class="toc-text">固定原子坐标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#一键生成-POTCAR-赝势文件"><span class="toc-number">2.</span> <span class="toc-text">一键生成 POTCAR 赝势文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#转动坐标系"><span class="toc-number">3.</span> <span class="toc-text">转动坐标系</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附：VASP固定轴优化方法"><span class="toc-number">4.</span> <span class="toc-text">附：VASP固定轴优化方法</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/posts_cover/POSCAR的脚本处理.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">何事？</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 图库</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">POSCAR的脚本处理</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-09-19<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2022-01-10</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/VASP/">VASP</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/poscar/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/poscar/" itemprop="commentCount"></span></a></div></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><p><code>POSCAR</code> 文件是 <code>VASP</code> 软件的输入文件之一，存放计算模型的原子结构。第一个脚本使用 <code>shell</code> 编写，可以对任意的原子位置在<strong>结构优化</strong>时进行固定操作。第二个脚本同样使用 <code>shell</code>, 可根据 <code>POSCAR</code> 生成相应的 <code>POTCAR</code> 赝势文件。第三个脚本使用 <code>matlab</code> 编写，目的是转换结构文件的坐标系，为后期处理轨道电荷做准备。最后，附上固定轴进行结构优化的方法，对于二维体系的结构优化十分重要。</p>
<h1 id="固定原子坐标"><a href="#固定原子坐标" class="headerlink" title="固定原子坐标"></a>固定原子坐标</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f POSCAR ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span></span><br><span class="line">	dos2unix -q POSCAR</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">" POSCAR is not exist !"</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$(sed -n '8p' POSCAR|cut -c 1)</span>"</span> = <span class="string">"S"</span> ];<span class="keyword">then</span></span><br><span class="line">	H=9</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	H=8</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">a=7</span><br><span class="line">b=$(wc -l POSCAR |cut -d <span class="string">' '</span> -f 1)</span><br><span class="line">c=$(sed -n <span class="string">"<span class="variable">$a</span> p"</span> POSCAR | awk <span class="string">'&#123;for(i=1;i&lt;=NF;i++)sum+=$i;print sum&#125;'</span>)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">	head -<span class="variable">$a</span> POSCAR &gt; poscar1</span><br><span class="line">	<span class="built_in">echo</span> Direct &gt;&gt;poscar1</span><br><span class="line">	tail -$((b-H)) POSCAR |head -<span class="variable">$c</span>|awk <span class="string">'&#123;printf("%23.18lf%23.18lf%23.18lf\n",$1,$2,$3)&#125;'</span> &gt;&gt; poscar1</span><br><span class="line">	cp poscar1 POSCAR</span><br><span class="line">	rm poscar1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	head -<span class="variable">$a</span> POSCAR &gt;poscar1</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Selective dynamic"</span> &gt;&gt; poscar1</span><br><span class="line">	<span class="built_in">echo</span> Direct &gt;&gt; poscar1</span><br><span class="line">	sel=<span class="string">" F F F"</span></span><br><span class="line">	selist=<span class="string">"TTT"</span></span><br><span class="line">	xyz=3</span><br><span class="line">	tail -$((b-H))  POSCAR |head -<span class="variable">$c</span> |awk <span class="string">'&#123;printf("%.18f %.18f %.18f ",$1,$2,$3);print " T T T"&#125;'</span> &gt;&gt; poscar1</span><br><span class="line">	H=9</span><br><span class="line">	cp poscar1 POSCAR</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> $*;<span class="keyword">do</span></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">"<span class="variable">$(echo $i|cut -c 1)</span>"</span> = <span class="string">"F"</span> || <span class="string">"<span class="variable">$(echo $i|cut -c 1)</span>"</span> = <span class="string">"f"</span> || <span class="string">"<span class="variable">$(echo $i|cut -c 1)</span>"</span> = <span class="string">"T"</span> || <span class="string">"<span class="variable">$(echo $i|cut -c 1)</span>"</span> = <span class="string">"t"</span> ]];<span class="keyword">then</span></span><br><span class="line">			sel=<span class="string">""</span></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> 1 2 3;<span class="keyword">do</span></span><br><span class="line">				t=$(<span class="built_in">echo</span> <span class="variable">$i</span>|cut -c <span class="variable">$j</span>)</span><br><span class="line">				<span class="keyword">if</span> [[ <span class="string">"<span class="variable">$t</span>"</span> = <span class="string">"T"</span> || <span class="string">"<span class="variable">$t</span>"</span> = <span class="string">"t"</span> ]];<span class="keyword">then</span></span><br><span class="line">					sel=<span class="variable">$sel</span><span class="string">" T"</span></span><br><span class="line">				<span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$t</span>"</span> = <span class="string">"F"</span> || <span class="string">"<span class="variable">$t</span>"</span> = <span class="string">"f"</span> ]];<span class="keyword">then</span></span><br><span class="line">					sel=<span class="variable">$sel</span><span class="string">" F"</span></span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					sel=<span class="variable">$sel</span><span class="string">" F"</span></span><br><span class="line">				<span class="keyword">fi</span></span><br><span class="line">			<span class="keyword">done</span></span><br><span class="line">		<span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"x"</span> || <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"a"</span> ]];<span class="keyword">then</span></span><br><span class="line">			xyz=1</span><br><span class="line">		<span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"y"</span> || <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"b"</span> ]];<span class="keyword">then</span></span><br><span class="line">			xyz=2</span><br><span class="line">		<span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"z"</span> || <span class="string">"<span class="variable">$i</span>"</span> = <span class="string">"c"</span> ]];<span class="keyword">then</span></span><br><span class="line">			xyz=3</span><br><span class="line">		<span class="keyword">elif</span> [ <span class="string">"<span class="variable">$(echo $i|cut -c 1)</span>"</span> = <span class="string">"~"</span> ];<span class="keyword">then</span></span><br><span class="line">			h=$(<span class="built_in">echo</span> <span class="variable">$i</span> |cut -c 2-)</span><br><span class="line">			<span class="keyword">if</span> [ $(<span class="built_in">echo</span> <span class="variable">$h</span>|grep -o <span class="string">"\."</span>|wc -l) -eq 1 ] 2&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">				head -<span class="variable">$H</span> poscar1 &gt; POSCAR</span><br><span class="line">				tail -<span class="variable">$c</span> poscar1 |awk <span class="string">'&#123;if($"'</span><span class="variable">$xyz</span><span class="string">'"&lt;"'</span><span class="variable">$h</span><span class="string">'")&#123;print " "$1" "$2" "$3" T T T"&#125;else&#123;print $0&#125;&#125;'</span> &gt;&gt; POSCAR</span><br><span class="line">			<span class="keyword">elif</span> [ <span class="variable">$h</span> -le <span class="variable">$c</span> ] 2&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">				head -<span class="variable">$H</span> poscar1 &gt; POSCAR</span><br><span class="line">				tail -<span class="variable">$c</span> poscar1 |awk <span class="string">'&#123;if(NR=="'</span><span class="variable">$h</span><span class="string">'")&#123;print " "$1" "$2" "$3" T T T"&#125;else&#123;print $0&#125;&#125;'</span> &gt;&gt; POSCAR</span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">if</span> [ $(<span class="built_in">echo</span> <span class="variable">$i</span>|grep -o <span class="string">"\."</span>|wc -l) -eq 1 ] 2&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">				head -<span class="variable">$H</span> poscar1 &gt; POSCAR</span><br><span class="line">				tail -<span class="variable">$c</span> poscar1 |awk <span class="string">'&#123;if($"'</span><span class="variable">$xyz</span><span class="string">'"&lt;"'</span><span class="variable">$i</span><span class="string">'")&#123;print " "$1" "$2" "$3"'</span><span class="string">"<span class="variable">$sel</span>"</span><span class="string">'"&#125;else&#123;print $0&#125;&#125;'</span> &gt;&gt; POSCAR</span><br><span class="line">			<span class="keyword">elif</span> [ <span class="variable">$i</span> -le <span class="variable">$c</span> ] 2&gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">				head -$((a+2)) poscar1 &gt; POSCAR</span><br><span class="line">				tail -<span class="variable">$c</span> poscar1 |awk <span class="string">'&#123;if(NR=="'</span><span class="variable">$i</span><span class="string">'")&#123;print " "$1" "$2" "$3"'</span><span class="string">"<span class="variable">$sel</span>"</span><span class="string">'"&#125;else&#123;print $0&#125;&#125;'</span> &gt;&gt; POSCAR</span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		cp POSCAR poscar1</span><br><span class="line">		selist=<span class="variable">$selist</span><span class="string">" "</span>$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$sel</span>"</span>|sed s/[[:space:]]//g)</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	head -<span class="variable">$H</span> poscar1 &gt; POSCAR</span><br><span class="line">	tail -<span class="variable">$c</span> poscar1 |awk <span class="string">'&#123;for(i=1;i&lt;=NF;i++)&#123;if($i~/^-/)&#123;$i=(" "$i)&#125;else&#123;$i=("  "$i)&#125;&#125;print " "$0&#125;'</span> &gt;&gt; POSCAR</span><br><span class="line">	selist=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$selist</span>"</span>|tr -s [:space:] \\n |sort|uniq)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$selist</span>;<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">echo</span> -n <span class="string">"<span class="variable">$i</span> : "</span></span><br><span class="line">		sel=$(<span class="built_in">echo</span> <span class="variable">$i</span>|sed -e <span class="string">"s/F/ F/g"</span> -e <span class="string">"s/T/ T/g"</span>)</span><br><span class="line">		tail -<span class="variable">$c</span> poscar1 |grep <span class="string">"<span class="variable">$sel</span>"</span> |wc -l</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	rm poscar1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<ul>
<li>用法</li>
</ul>
<p>使用前给脚本执行权限：<code>chmod 777 脚本名</code></p>
<p>在脚本所在目录输入 <code>./脚本名 关键词1 关键词2 关键词3 ……</code></p>
<ul>
<li>可设值的关键词有：</li>
</ul>
<p>1 固定格式， 如 <code>TTF</code> 表示只固定原子的 z 方向坐标，默认不输入为所有分量都固定与 <code>FFF</code> 等效，通常情况下不需要指定。</p>
<p>2 选择需要固定的原子。脚本提供了两种选择方式，第一种为直接输入一个正整数 N ，代表固定的第 N 号原子。该方法复杂，需要查看固定原子的序号。因此，当需要固定的原子多时， 推荐另外一种方法：</p>
<p>3 第二种方法由两个关键词组成。例如 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./脚本名 a 1.2</span><br></pre></td></tr></table></figure>
<p>该脚本实现的目的为当原子的 a 方向分量小于1.2时，则对该原子进行固定。a 为判断比较的轴，可是输入 a， b， c或者x， y， z。如果不输入，则默认比较c轴。例如对结构文件进行固定基底的操作，可以直接输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./脚本名 0.2</span><br></pre></td></tr></table></figure>
<p>注意，为了与第一种方法区分，该方法输入的数字必须为小数。如果需要对比较轴的中间部分原子进行固定，脚本提供了在小数前加‘~’的方法，如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./脚本名 0.3 ~0.1</span><br></pre></td></tr></table></figure>
<p>该命令表示对 c 方向原子 在 0.1 到 0.3 之间的原子进行固定。‘~0.1’ 表示为当 c 方向分量小于0.1时，设置原子为 <code>TTT</code>， 即对该部分原子不固定。</p>
<p>4 两种方法可以混合使用。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./脚本名 3 0.8 FFT 0.3 ~0.1 a 0.5</span><br></pre></td></tr></table></figure>

<p>5 当关键词为空时，对 <code>POSCAR</code> 进行还原操作，取消所有对原子的固定。</p>
<hr>
<h1 id="一键生成-POTCAR-赝势文件"><a href="#一键生成-POTCAR-赝势文件" class="headerlink" title="一键生成 POTCAR 赝势文件"></a>一键生成 POTCAR 赝势文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ad=<span class="string">'赝势所在目录'</span></span><br><span class="line"></span><br><span class="line">ad=<span class="variable">$&#123;ad%/&#125;</span></span><br><span class="line"><span class="keyword">if</span> [ -f POSCAR ];<span class="keyword">then</span></span><br><span class="line">	dos2unix -q POSCAR</span><br><span class="line">	el=$(sed -n <span class="string">'6p'</span> POSCAR)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">" POSCAR does not exist , Please enter the required elements :"</span></span><br><span class="line">	<span class="built_in">read</span> el</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">ell=<span class="variable">$el</span></span><br><span class="line">el=<span class="string">""</span></span><br><span class="line">b=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$ell</span>;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$(tail -97 $0|grep " $i "|awk '&#123;print $3&#125;')</span>"</span> ];<span class="keyword">then</span></span><br><span class="line">		el=<span class="variable">$el</span><span class="string">" "</span><span class="variable">$i</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		el=<span class="variable">$el</span><span class="string">" "</span>$(tail -97 <span class="variable">$0</span>|grep <span class="string">" <span class="variable">$i</span> "</span>|awk <span class="string">'&#123;print $3&#125;'</span>)</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$el</span>"</span> = <span class="string">""</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">err=<span class="string">""</span></span><br><span class="line">e=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$el</span>;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ ! -d <span class="variable">$ad</span>/<span class="variable">$i</span> ];<span class="keyword">then</span></span><br><span class="line">		err=<span class="variable">$err</span><span class="string">"  "</span><span class="variable">$i</span></span><br><span class="line">		((e++))</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$e</span> -ne 0 ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"  POTCAR for elements does not exist  :  <span class="variable">$e</span> <span class="variable">$err</span> ."</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -f POTCAR ];<span class="keyword">then</span></span><br><span class="line">	rm POTCAR</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">touch POTCAR potcar</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$el</span>;<span class="keyword">do</span></span><br><span class="line">	cat <span class="variable">$ad</span>/<span class="variable">$i</span>/POTCAR &gt;&gt; POTCAR</span><br><span class="line">	<span class="built_in">echo</span> -n <span class="string">"<span class="variable">$i</span>"</span> &gt;&gt; potcar</span><br><span class="line">	grep <span class="string">'ENMAX'</span> <span class="variable">$ad</span>/<span class="variable">$i</span>/POTCAR &gt;&gt; potcar</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">column -t potcar</span><br><span class="line">rm potcar</span><br><span class="line"></span><br><span class="line"><span class="comment">#Element   Official   #以下为每个原子的官方推荐赝势，可自行对第三列进行修改。</span></span><br><span class="line"><span class="comment">#001 H     H         </span></span><br><span class="line"><span class="comment">#002 He    He        </span></span><br><span class="line"><span class="comment">#003 Li    Li_sv     </span></span><br><span class="line"><span class="comment">#004 Be    Be        </span></span><br><span class="line"><span class="comment">#005 B     B         </span></span><br><span class="line"><span class="comment">#006 C     C         </span></span><br><span class="line"><span class="comment">#007 N     N         </span></span><br><span class="line"><span class="comment">#008 O     O         </span></span><br><span class="line"><span class="comment">#009 F     F         </span></span><br><span class="line"><span class="comment">#010 Ne    Ne        </span></span><br><span class="line"><span class="comment">#011 Na    Na_pv     </span></span><br><span class="line"><span class="comment">#012 Mg    Mg        </span></span><br><span class="line"><span class="comment">#013 Al    Al        </span></span><br><span class="line"><span class="comment">#014 Si    Si        </span></span><br><span class="line"><span class="comment">#015 P     P         </span></span><br><span class="line"><span class="comment">#016 S     S         </span></span><br><span class="line"><span class="comment">#017 Cl    Cl        </span></span><br><span class="line"><span class="comment">#018 Ar    Ar        </span></span><br><span class="line"><span class="comment">#019 K     K_sv      </span></span><br><span class="line"><span class="comment">#020 Ca    Ca_sv     </span></span><br><span class="line"><span class="comment">#021 Sc    Sc_sv     </span></span><br><span class="line"><span class="comment">#022 Ti    Ti_sv     </span></span><br><span class="line"><span class="comment">#023 V     V_sv      </span></span><br><span class="line"><span class="comment">#024 Cr    Cr_pv     </span></span><br><span class="line"><span class="comment">#025 Mn    Mn_pv     </span></span><br><span class="line"><span class="comment">#026 Fe    Fe        </span></span><br><span class="line"><span class="comment">#027 Co    Co        </span></span><br><span class="line"><span class="comment">#028 Ni    Ni        </span></span><br><span class="line"><span class="comment">#029 Cu    Cu        </span></span><br><span class="line"><span class="comment">#030 Zn    Zn        </span></span><br><span class="line"><span class="comment">#031 Ga    Ga_d      </span></span><br><span class="line"><span class="comment">#032 Ge    Ge_d      </span></span><br><span class="line"><span class="comment">#033 As    As        </span></span><br><span class="line"><span class="comment">#034 Se    Se        </span></span><br><span class="line"><span class="comment">#035 Br    Br        </span></span><br><span class="line"><span class="comment">#036 Kr    Kr        </span></span><br><span class="line"><span class="comment">#037 Rb    Rb_sv     </span></span><br><span class="line"><span class="comment">#038 Sr    Sr_sv     </span></span><br><span class="line"><span class="comment">#039 Y     Y_sv      </span></span><br><span class="line"><span class="comment">#040 Zr    Zr_sv     </span></span><br><span class="line"><span class="comment">#041 Nb    Nb_sv     </span></span><br><span class="line"><span class="comment">#042 Mo    Mo_sv     </span></span><br><span class="line"><span class="comment">#043 Tc    Tc_pv     </span></span><br><span class="line"><span class="comment">#044 Ru    Ru_pv     </span></span><br><span class="line"><span class="comment">#045 Rh    Rh_pv     </span></span><br><span class="line"><span class="comment">#046 Pd    Pd        </span></span><br><span class="line"><span class="comment">#047 Ag    Ag        </span></span><br><span class="line"><span class="comment">#048 Cd    Cd        </span></span><br><span class="line"><span class="comment">#049 In    In_d      </span></span><br><span class="line"><span class="comment">#050 Sn    Sn_d      </span></span><br><span class="line"><span class="comment">#051 Sb    Sb        </span></span><br><span class="line"><span class="comment">#052 Te    Te        </span></span><br><span class="line"><span class="comment">#053 I     I         </span></span><br><span class="line"><span class="comment">#054 Xe    Xe        </span></span><br><span class="line"><span class="comment">#055 Cs    Cs_sv     </span></span><br><span class="line"><span class="comment">#056 Ba    Ba_sv     </span></span><br><span class="line"><span class="comment">#057 La    La        </span></span><br><span class="line"><span class="comment">#058 Ce    Ce        </span></span><br><span class="line"><span class="comment">#059 Pr    Pr_3      </span></span><br><span class="line"><span class="comment">#060 Nd    Nd_3      </span></span><br><span class="line"><span class="comment">#061 Pm    Pm_3      </span></span><br><span class="line"><span class="comment">#062 Sm    Sm_3      </span></span><br><span class="line"><span class="comment">#063 Eu    Eu_2      </span></span><br><span class="line"><span class="comment">#064 Gd    Gd_3      </span></span><br><span class="line"><span class="comment">#065 Tb    Tb_3      </span></span><br><span class="line"><span class="comment">#066 Dy    Dy_3      </span></span><br><span class="line"><span class="comment">#067 Ho    Ho_3      </span></span><br><span class="line"><span class="comment">#068 Er    Er_3      </span></span><br><span class="line"><span class="comment">#069 Tm    Tm_3      </span></span><br><span class="line"><span class="comment">#070 Yb    Yb_2      </span></span><br><span class="line"><span class="comment">#071 Lu    Lu_3      </span></span><br><span class="line"><span class="comment">#072 Hf    Hf_pv     </span></span><br><span class="line"><span class="comment">#073 Ta    Ta_pv     </span></span><br><span class="line"><span class="comment">#074 W     W_pv      </span></span><br><span class="line"><span class="comment">#075 Re    Re        </span></span><br><span class="line"><span class="comment">#076 Os    Os        </span></span><br><span class="line"><span class="comment">#077 Ir    Ir        </span></span><br><span class="line"><span class="comment">#078 Pt    Pt        </span></span><br><span class="line"><span class="comment">#079 Au    Au        </span></span><br><span class="line"><span class="comment">#080 Hg    Hg        </span></span><br><span class="line"><span class="comment">#081 Tl    Tl_d      </span></span><br><span class="line"><span class="comment">#082 Pb    Pb_d      </span></span><br><span class="line"><span class="comment">#083 Bi    Bi_d      </span></span><br><span class="line"><span class="comment">#084 Po    Po_d      </span></span><br><span class="line"><span class="comment">#085 At    At_d      </span></span><br><span class="line"><span class="comment">#086 Rn    Rn        </span></span><br><span class="line"><span class="comment">#087 Fr    Fr_sv     </span></span><br><span class="line"><span class="comment">#088 Re    Ra_sv     </span></span><br><span class="line"><span class="comment">#089 Ac    Ac        </span></span><br><span class="line"><span class="comment">#090 Th    Th        </span></span><br><span class="line"><span class="comment">#091 Pa    Pa        </span></span><br><span class="line"><span class="comment">#092 U     U         </span></span><br><span class="line"><span class="comment">#093 Np    Np        </span></span><br><span class="line"><span class="comment">#094 Pu    Pu        </span></span><br><span class="line"><span class="comment">#095 Am    Am        </span></span><br><span class="line"><span class="comment">#096 Cm    Cm</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用时，需要将脚本第三行指定到赝势所在目录。给脚本执行权限后，直接输入 <code>./脚本名</code> 即可。</li>
</ul>
<hr>
<h1 id="转动坐标系"><a href="#转动坐标系" class="headerlink" title="转动坐标系"></a>转动坐标系</h1><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">latt</span><span class="params">(latter,o,z,x)</span></span></span><br><span class="line">format long</span><br><span class="line">z=z-o</span><br><span class="line">x=x-o</span><br><span class="line">z=z*latter</span><br><span class="line">x=x*latter</span><br><span class="line">z=z/norm(z)</span><br><span class="line">x=x/norm(x)</span><br><span class="line">y=<span class="built_in">cross</span>(z,x)</span><br><span class="line">y=y/norm(y)</span><br><span class="line">x=<span class="built_in">cross</span>(y,z)</span><br><span class="line">tran=[x; y; z;]</span><br><span class="line">new_latt=latter*inv(tran)</span><br><span class="line">sprintf(<span class="string">'%20.16f %20.16f %20.16f\n'</span>,new_latt')</span><br></pre></td></tr></table></figure>

<p>脚本需要输入4个参数，可以在 <code>matlab</code> 或 <code>octave</code> 软件中运行。</p>
<p>1 原坐标系，即 <code>POSCAR</code> 文件的3-5行。</p>
<p>2 新坐标系的原点坐标</p>
<p>3 新坐标系的z方向矢量</p>
<p>4 新坐标系的x方向矢量</p>
<p>注意：转换的新坐标系为直角坐标系。</p>
<hr>
<h1 id="附：VASP固定轴优化方法"><a href="#附：VASP固定轴优化方法" class="headerlink" title="附：VASP固定轴优化方法"></a>附：VASP固定轴优化方法</h1><p>VASP输入中没有提供设置优化轴的参数，需要对VASP中 <code>constr_cell_relax.F</code> 文件修改，并重新编译。修改的部分为：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">      <span class="function"><span class="keyword">SUBROUTINE</span></span> CONSTR_CELL_RELAX(FCELL)</span><br><span class="line">      <span class="keyword">USE</span> prec</span><br><span class="line">      <span class="keyword">REAL</span>(q) FCELL(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">!     just one simple example</span></span><br><span class="line"><span class="comment">!     relaxation in x directions only</span></span><br><span class="line"><span class="comment">!      SAVE=FCELL(1,1)</span></span><br><span class="line"><span class="comment">!      FCELL=0   ! F90 style: set the whole array to zero</span></span><br><span class="line"><span class="comment">!      FCELL(1,1)=SAVE</span></span><br><span class="line"><span class="comment">!     relaxation in z direction only</span></span><br><span class="line"><span class="comment">!      SAVE=FCELL(3,3)</span></span><br><span class="line"><span class="comment">!      FCELL=0   ! F90 style: set the whole array to zero</span></span><br><span class="line"><span class="comment">!      FCELL(3,3)=SAVE</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">LOGICAL</span> FILFLG</span><br><span class="line">      <span class="keyword">INTEGER</span> ICELL(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">      INQUIRE(<span class="keyword">FILE</span>=<span class="string">'OPTCELL'</span>,<span class="keyword">EXIST</span>=FILFLG)</span><br><span class="line">      <span class="keyword">IF</span> (FILFLG) <span class="keyword">THEN</span></span><br><span class="line">         OPEN(<span class="number">67</span>,<span class="keyword">FILE</span>=<span class="string">'OPTCELL'</span>,<span class="keyword">FORM</span>=<span class="string">'FORMATTED'</span>,<span class="keyword">STATUS</span>=<span class="string">'OLD'</span>)</span><br><span class="line">         <span class="keyword">DO</span> J=<span class="number">1</span>,<span class="number">3</span></span><br><span class="line">            READ(<span class="number">67</span>,<span class="string">"(3I1)"</span>) (ICELL(I,J),I=<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">         <span class="keyword">ENDDO</span></span><br><span class="line">         CLOSE(<span class="number">67</span>)</span><br><span class="line">         <span class="keyword">DO</span> J=<span class="number">1</span>,<span class="number">3</span></span><br><span class="line">         <span class="keyword">DO</span> I=<span class="number">1</span>,<span class="number">3</span></span><br><span class="line">            <span class="keyword">IF</span> (ICELL(I,J)==<span class="number">0</span>) FCELL(I,J)=<span class="number">0.0</span></span><br><span class="line">         <span class="keyword">ENDDO</span></span><br><span class="line">         <span class="keyword">ENDDO</span></span><br><span class="line">      <span class="keyword">ENDIF</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">RETURN</span></span><br><span class="line">      <span class="keyword">END</span> <span class="function"><span class="keyword">SUBROUTINE</span></span></span><br></pre></td></tr></table></figure>

<p>运行时需要提供额外的一个输入文件 <code>OPTCELL</code>，在文件中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">110</span><br><span class="line">110</span><br><span class="line">000</span><br></pre></td></tr></table></figure>
<p>即为固定z轴优化，且x，y轴夹角不发生变化。这在对二维材料的优化中十分关键。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">孙 伟</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://sweiweb.gitee.io/poscar/">https://sweiweb.gitee.io/poscar/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://sweiweb.gitee.io" target="_blank">何事？</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%84%9A%E6%9C%AC/">脚本    </a><a class="post-meta__tags" href="/tags/shell/">shell    </a><a class="post-meta__tags" href="/tags/matlab/">matlab    </a></div><div class="post_share"><div class="social-share" data-image="/img/posts_cover/windows子系统WSL的配置.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/replace_icon/"><img class="prev_cover lazyload" data-src="/img/posts_cover/替换EXE图标.jpg" onerror="onerror=null;src='/img/theme/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">替换EXE图标</div></div></a></div><div class="next-post pull_right"><a href="/ssh_script/"><img class="next_cover lazyload" data-src="/img/posts_cover/SSH远程登录脚本.jpg" onerror="onerror=null;src='/img/theme/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SSH远程登录脚本</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/wannier90/" title="VASP+wannier90安装"><img class="relatedPosts_cover lazyload"data-src="/img/posts_cover/VASP+wannier90安装.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-11-10</div><div class="relatedPosts_title">VASP+wannier90安装</div></div></a></div><div class="relatedPosts_item"><a href="/table/" title="数据的表格可视化"><img class="relatedPosts_cover lazyload"data-src="/img/posts_cover/数据的表格可视化.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-06-16</div><div class="relatedPosts_title">数据的表格可视化</div></div></a></div><div class="relatedPosts_item"><a href="/ssh_script/" title="SSH远程登录脚本"><img class="relatedPosts_cover lazyload"data-src="/img/posts_cover/SSH远程登录脚本.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-09-18</div><div class="relatedPosts_title">SSH远程登录脚本</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="/js/comments/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: true,
  appId: 'GSUbmSNQhweoONsjy228fCwi-MdYXbMMI',
  appKey: 'f4EloIcFHsYVr8VQv5y92hW5',
  placeholder: '留下你的脚印👣吧…',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(/img/posts_cover/POSCAR的脚本处理.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 孙 伟</div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script></body></html>